{"version":3,"file":"export.min.js","sources":["../src/export.js"],"sourcesContent":["define(['jquery', 'core/notification'], function($, Notification) {\n    'use strict';\n\n    /* global loadPyodide */\n\n    /**\n     * Loads Pyodide and the nbformat package using micropip.\n     * Caches the Pyodide instance in `window.pyodide`.\n     *\n     * @returns {Promise<Object>} The loaded Pyodide instance.\n     */\n    async function loadPyodideAndPackages() {\n        if (!window.pyodide) {\n            Notification.addNotification({\n                message: 'Loading in browser Python environment...',\n                type: 'info'\n            });\n\n            window.pyodide = await loadPyodide({\n                indexURL: \"https://cdn.jsdelivr.net/pyodide/v0.25.1/full/\"\n            });\n\n            await window.pyodide.loadPackage(\"micropip\");\n\n            await window.pyodide.runPythonAsync(`\n                import micropip\n                await micropip.install(\"nbformat\")\n            `);\n        }\n\n        return window.pyodide;\n    }\n\n    /**\n     * Generates a Jupyter Notebook (.ipynb) for a given assignment name,\n     * using nbformat from Python inside Pyodide.\n     * @param {string} name\n     * @param {string} description\n     * @param {string} instructions\n     */\n    async function generateNotebook(name, description, instructions) {\n        const pyodide = await loadPyodideAndPackages();\n\n        // Clean up name for filename\n        const safeName = name\n            .replace(/[^\\w\\s-]/g, '') // Remove symbols\n            .replace(/\\s+/g, '_'); // Spaces to underscores\n\n        // Python code to generate notebook using nbformat\n        const pythonCode = `\nimport nbformat as nbf\n\nnb = nbf.v4.new_notebook()\n\ncells = []\n\ncells.append(nbf.v4.new_markdown_cell('### Assignment: ${name}\\\\n>This notebook was generated from Moodle A2NB Plugin.'))\ncells.append(nbf.v4.new_markdown_cell('#### Description:\\\\n${description}'))\ncells.append(nbf.v4.new_markdown_cell(\"\"\"#### Instructions:\\\\n${instructions}\"\"\"))\n\n\nnb.cells = cells\nnb_str = nbf.writes(nb)\nnb_str\n        `;\n\n        try {\n            const notebookStr = await pyodide.runPythonAsync(pythonCode);\n\n            // Create a downloadable blob\n            const blob = new Blob([notebookStr], { type: 'application/json' });\n            const link = document.createElement('a');\n            link.href = URL.createObjectURL(blob);\n            link.download = `${safeName}.ipynb`;\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n        } catch (error) {\n            Notification.exception(error);\n        }\n    }\n\n    /**\n     * Initializes event delegation for all buttons with `.create-ipynb`.\n     * Reads assignment name from `data-assignment` attribute.\n     */\n    function init() {\n        $(document).on('click', '.create-ipynb', function () {\n            const name = $(this).data('name');\n            const description = $(this).data('description');\n            const instructions = $(this).data('instructions');\n\n            if (!name || !description || !instructions) {\n                Notification.alert('Assignment infos not fully provided.');\n                return;\n            }\n\n            Notification.addNotification({\n                message: `Generating notebook for \"${name}\"...`,\n                type: 'info'\n            });\n\n            generateNotebook(name, description, instructions);\n        });\n    }\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","Notification","generateNotebook","name","description","instructions","pyodide","window","addNotification","message","type","loadPyodide","indexURL","loadPackage","runPythonAsync","loadPyodideAndPackages","safeName","replace","pythonCode","notebookStr","blob","Blob","link","document","createElement","href","URL","createObjectURL","download","body","appendChild","click","removeChild","error","exception","init","on","this","data","alert"],"mappings":"AAAAA,2BAAO,CAAC,SAAU,sBAAsB,SAASC,EAAGC,6BAwCjCC,iBAAiBC,KAAMC,YAAaC,oBACzCC,sCA7BDC,OAAOD,UACRL,aAAaO,gBAAgB,CACzBC,QAAS,2CACTC,KAAM,SAGVH,OAAOD,cAAgBK,YAAY,CAC/BC,SAAU,yDAGRL,OAAOD,QAAQO,YAAY,kBAE3BN,OAAOD,QAAQQ,eAAgB,wGAMlCP,OAAOD,QAWQS,GAGhBC,SAAWb,KACZc,QAAQ,YAAa,IACrBA,QAAQ,OAAQ,KAGfC,WAAc,kIAO6Bf,+HACIC,iFACGC,+FAS9Cc,kBAAoBb,QAAQQ,eAAeI,YAG3CE,KAAO,IAAIC,KAAK,CAACF,aAAc,CAAET,KAAM,qBACvCY,KAAOC,SAASC,cAAc,KACpCF,KAAKG,KAAOC,IAAIC,gBAAgBP,MAChCE,KAAKM,SAAY,GAAEZ,iBACnBO,SAASM,KAAKC,YAAYR,MAC1BA,KAAKS,QACLR,SAASM,KAAKG,YAAYV,MAC5B,MAAOW,OACLhC,aAAaiC,UAAUD,cA4BxB,CACHE,gBApBAnC,EAAEuB,UAAUa,GAAG,QAAS,iBAAiB,iBAC/BjC,KAAOH,EAAEqC,MAAMC,KAAK,QACpBlC,YAAcJ,EAAEqC,MAAMC,KAAK,eAC3BjC,aAAeL,EAAEqC,MAAMC,KAAK,gBAE7BnC,MAASC,aAAgBC,cAK9BJ,aAAaO,gBAAgB,CACzBC,QAAU,4BAA2BN,WACrCO,KAAM,SAGVR,iBAAiBC,KAAMC,YAAaC,eAThCJ,aAAasC,MAAM"}